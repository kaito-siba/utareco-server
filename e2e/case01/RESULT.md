# CASE01 同一性判定実装まとめ

## 最終実装

高度な特徴ベースの同一性判定を採用しました。

### アルゴリズム詳細 (`app/core/matching/similarity.py`)

1. **グローバル特徴（30%）**
   - 全フレームの平均HPCPベクトル
   - 12半音の転調を考慮した最適マッチング

2. **ヒストグラム特徴（30%）**
   - 各ピッチクラスの強度分布を24ビンのヒストグラムで表現
   - 転調不変の特徴として機能

3. **時系列特徴（40%）**
   - 楽曲を10セグメントに分割
   - 各セグメントの平均と標準偏差を特徴として使用
   - 楽曲の時間的な構造を捉える

### テスト実行方法

```bash
./e2e/run_test_docker.sh
```

### 判定結果

- **閾値**: 0.95
- **同一楽曲の類似度**: 1.0000（完全一致）
- **異なる楽曲の類似度**: 0.8591-0.9080
- **全テストケース**: PASS

### なぜこの実装を選んだか

1. **安定性**: 閾値0.95で十分な余裕を持って判定可能
2. **精度**: 時系列情報を含むため、より正確な判定が可能
3. **メモリ効率**: ChromaCrossSimilarityの大きな行列を使わず、軽量に動作

## 削除した実装

- シンプル版: 閾値0.995とギリギリの判定だったため不採用
- DTW版: 未実装のまま削除
- ChromaCrossSimilarity版: メモリ問題があり、閾値調整も必要だったため不採用